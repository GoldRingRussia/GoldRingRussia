<!DOCTYPE html>
<html>
<head>
    <title>Золотое кольцо России - Автоматическая анимация</title>
    <meta charset="utf-8">
    <script src="https://api-maps.yandex.ru/2.1/?apikey=ae7aeeeb-2a37-489d-89d8-2b172c8fc512&lang=ru_RU"></script>
    <style>
        #map {
            width: 600px;
            height: 600px;
        }
        .city-info {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255,255,255,0.9);
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 0 15px rgba(0,0,0,0.2);
            z-index: 100;
            max-width: 300px;
            font-family: Arial, sans-serif;
            display: none;
        }
        .city-info h3 {
            color: #FF6B00;
            margin-top: 0;
        }
        .loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 101;
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 20px;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <div id="map"></div>
    <div class="city-info" id="cityInfo"></div>
    <div class="loading" id="loading">Загрузка карты...</div>

    <script>
        function checkYMaps() {
            if (!window.ymaps) {
                document.getElementById('map').innerHTML = 
                    '<div style="color:red;padding:20px;text-align:center;">' +
                    'Ошибка загрузки Яндекс.Карт. Проверьте:<br>' +
                    '1. Интернет-соединение<br>' +
                    '2. Правильность API-ключа<br>' +
                    '3. Что ключ активирован в кабинете разработчика' +
                    '</div>';
                return false;
            }
            return true;
        }

        if (!checkYMaps()) {
            throw new Error("Yandex Maps API не загружен");
        }

        ymaps.ready(init);
        
        const cities = [
            { name: "Сергиев Посад", coords: [56.3100, 38.1300], 
              info: "Сергиев Посад - духовный центр России, знаменитый Троице-Сергиевой лаврой, основанной в 1337 году." },
            { name: "Переславль-Залесский", coords: [56.7360, 38.8533], 
              info: "Основан в 1152 году Юрием Долгоруким. Здесь находится Плещеево озеро и музей «Ботик Петра I»." },
            { name: "Ростов Великий", coords: [57.1847, 39.4145], 
              info: "Известен с 862 года. Ростовский кремль - жемчужина русской архитектуры XVII века." },
            { name: "Ярославль", coords: [57.6261, 39.8845], 
              info: "Основан в 1010 году. Исторический центр включен в список Всемирного наследия ЮНЕСКО." },
            { name: "Кострома", coords: [57.7678, 40.9269], 
              info: "Основана в 1152 году. Знаменита Ипатьевским монастырем и памятником Ивану Сусанину." },
            { name: "Иваново", coords: [57.0004, 40.9739], 
              info: "Город невест с богатой текстильной историей. Известен конструктивистской архитектурой 1920-30-х годов." },
            { name: "Суздаль", coords: [56.4274, 40.4526], 
              info: "Впервые упоминается в 1024 году. Сохранил атмосферу древнерусского города с 40 церквями." },
            { name: "Владимир", coords: [56.1290, 40.4070], 
              info: "Основан в 1108 году. Золотые ворота и Успенский собор - шедевры древнерусского зодчества." }
        ];

        let map, polyline;
        let placemarks = [];
        let animationTimer;
        let currentPointIndex = 0;
        let allPoints = [];

        function init() {
            try {

                document.getElementById('loading').style.display = 'none';
                
                map = new ymaps.Map("map", {
                    center: [56.8, 39.5],
                    zoom: 7,
                    controls: ['zoomControl', 'typeSelector']
                });


                startTour();
                
            } catch (e) {
                console.error('Ошибка инициализации карты:', e);
                document.getElementById('loading').innerHTML = 'Ошибка при загрузке карты: ' + e.message;
            }
        }

        function startTour() {

            polyline = new ymaps.Polyline([], {
                balloonContent: "Маршрут по Золотому кольцу России"
            }, {
                strokeColor: "#FF6B00",
                strokeWidth: 5,
                strokeOpacity: 0.9
            });
            map.geoObjects.add(polyline);


            cities.forEach((city, index) => {
                let placemark = new ymaps.Placemark(city.coords, {
                    balloonContent: `<strong>${city.name}</strong><br>${city.info}`,
                    iconContent: index + 1
                }, {
                    preset: 'islands#darkOrangeStretchyIcon',
                    iconColor: '#FF6B00'
                });
                placemarks.push(placemark);
                map.geoObjects.add(placemark);
            });


            allPoints = [];
            for (let i = 0; i < cities.length - 1; i++) {
                let segment = interpolatePoints(cities[i].coords, cities[i+1].coords, 100);
                allPoints = allPoints.concat(segment);
            }
            allPoints.push(cities[cities.length-1].coords); 


            map.setBounds(map.geoObjects.getBounds(), {
                checkZoomRange: true,
                zoomMargin: 50
            });


            currentPointIndex = 0;
            animateRoute();
        }


        function interpolatePoints(start, end, pointsCount) {
            let points = [];
            for (let i = 0; i <= pointsCount; i++) {
                let ratio = i / pointsCount;

                let curveRatio = Math.sin(ratio * Math.PI / 2);
                let lat = start[0] + (end[0] - start[0]) * curveRatio;
                let lon = start[1] + (end[1] - start[1]) * curveRatio;
                points.push([lat, lon]);
            }
            return points;
        }

        function animateRoute() {
            if (currentPointIndex < allPoints.length) {
                let currentSegment = allPoints.slice(0, currentPointIndex + 1);
                polyline.geometry.setCoordinates(currentSegment);
                

                if (currentPointIndex % 20 === 0) {
                    map.panTo(currentSegment[currentSegment.length - 1], {
                        flying: true,
                        duration: 500
                    });
                }
                

                cities.forEach((city, index) => {
                    let triggerPoint = Math.floor((index / cities.length) * allPoints.length);
                    if (currentPointIndex >= triggerPoint && currentPointIndex <= triggerPoint + 5) {
                        showCityInfo(city);
                    }
                });
                
                currentPointIndex++;
                animationTimer = setTimeout(animateRoute, 30);
            } else {

                setTimeout(() => {
                    resetTour();
                    startTour();
                }, 5000);
            }
        }

        function showCityInfo(city) {
            let infoBox = document.getElementById('cityInfo');
            infoBox.innerHTML = `
                <h3>${city.name}</h3>
                <p>${city.info}</p>
                <small>${new Date().toLocaleTimeString()}</small>
            `;
            infoBox.style.display = 'block';
            

            setTimeout(() => {
                infoBox.style.display = 'none';
            }, 7000);
        }

        function resetTour() {
            clearTimeout(animationTimer);
            
            if (polyline) {
                map.geoObjects.remove(polyline);
            }
            
            placemarks.forEach(pm => map.geoObjects.remove(pm));
            placemarks = [];
            allPoints = [];
            currentPointIndex = 0;
            
            document.getElementById('cityInfo').style.display = 'none';
        }
    </script>
</body>
</html>